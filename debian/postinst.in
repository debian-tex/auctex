#include "variables"
#!/bin/bash -e
#
# postinst configuration file for Debian auctex package.
# $Id: postinst.in,v 1.5 1999/10/14 14:39:35 salve Exp $
#
<:=@COPYRIGHT:>//

set -o posix

source <:=$CONFMODULE:>

#---B-E-G-I-N---O-L-D---S-T-U-F-F---(keep-it,-it-doesn't-hurt)-----------------
for i in /usr/lib/emacs/common/auctex/auto/ /var/lib/emacs/auctex/; do
    if test -d $i
	then rm -rf $i
    fi
done
for i in /usr/lib/emacs/common/auctex /usr/lib/emacs/common; do
    if test -d $i
	then find ${i%/*} -name ${i##*/} -type d -empty | xargs --no-run-if-empty rmdir
    fi
done
#---E-N-D---O-L-D---S-T-U-F-F--------------------------------------------------

conf_autoload () {
    db_get <:=$PACKAGE:>/default
    if [ $RET = "true" ]; then umask 022;
	cat <<-EOF ><:=$sstartd:>/<:=$EPRIORITY:><:=$PACKAGE:>
		(require 'tex-site);') <- beauty stuff
	EOF
	chmod 644 <:=$sstartd:>/<:=$EPRIORITY:><:=$PACKAGE:>
    else
	rm -f <:=$sstartd:>/<:=$EPRIORITY:><:=$PACKAGE:>
    fi
    return 0
}

do_auto () {
    db_get <:=$PACKAGE:>/logfile
    LOGFILE=$RET
    db_get <:=$PACKAGE:>/doauto
    case "$RET" in
	Foreground)
	    rm -f $LOGFILE
	    <:="$sbin/$UPDATE":>
	;;
	Background)
	    # Closing fd 3 is debconf important.
	    <:# debconf's frontend wait for its standard input to be closed:>//
	    <:# before dying, and that means fd 3:>//
	    <:# better don't close fd 0: emacs doesn't take it very well:>//
	    <:# WARNING: DON'T CLOSE FD'S TO BE WRITTEN TO!:>//
	    <:# WARNING: DON'T CLOSE FD'S TO BE READ TO!:>// 
	    <:="$sbin/$UPDATE":> &> $LOGFILE 3>&- &
	    echo -n "update-auctex-elisp[$!]: "
	    echo "Further output will appear in: $LOGFILE"
	;;
	None)
	    rm -f $LOGFILE
	;;
	*)
	    echo "${0##*/}: Debconf passed unknow value \`$RET'." >&2
	;;
    esac
    return 0
}

do_link () {
    test -d /usr/doc -a ! -e /usr/doc/<:=$PACKAGE:> \
	 -a -d /usr/share/doc/<:=$PACKAGE:> \
	 && ln -sf ../share/doc/<:=$PACKAGE:> /usr/doc/<:=$PACKAGE:>
    return 0
}

case "$1" in
    abort-remove|abort-upgrade|configure)
    <:# abort-remove in-favour ${3:newpkg} ${4:newver}
      # (undo prerm remove in-favour $3 $4):>//
    <:# abort-upgrade ${2:newver}
      # (undo prerm upgrade $2):>//
    <:# configure ${2:lastconfver}
      # (or, if there wasn't an old version at all)
      # configure ${2=""|"<unknow>"}
      # (or, if dpkg version is very old)
      # configure
      # (dregistered files and conffiles have been installed):>//
	<:# install byte compiled lisp:>//
	<:=$EINSTALL:> <:=$PACKAGE:>
	<:# parse TeX macros and LaTeX styles:>//
	do_auto
	<:# install compatibility link:>//
	do_link
	<:# install info menu into info dir:>//
	<:=$DINSTALL:> <:="$docbase/$PACKAGE":>
	<:# install info menu into info dir:>//
	<:=$IINSTALL:> <:="$info/$PACKAGE.info.gz":>
	<:# put or remove emacs startup file:>//
	conf_autoload
    ;;
    abort-deconfigure)
    <:# abort-deconfigure in-favour ${3:newpkg} ${4:newver} removing ${6:oldpkg} ${7:oldver}
      # (undo prerm deconfigure in-favour $3 $4 removing $6 $7):>//
	<:# put or remove emacs startup file:>//
	conf_autoload
    ;;
    *)
	echo "${0##*/}: Called with unknown argument \`$1'." >&2
    ;;
esac

<:# to be sure debconf moves on:>//
db_stop

exit 0
<:
# Local Variables:
# mode: shell-script
# End:
:>//
