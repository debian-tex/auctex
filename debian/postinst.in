#include "variables"
#!/bin/bash -e
#
# postinst configuration file for Debian <:=${PACKAGE}:> package.
# $Id: postinst.in,v 1.13 2002/01/18 16:04:09 salve Exp $
#
<:=@COPYRIGHT:>//

set -o posix

<:# parse debconf database:>//
source <:=${CONFMODULE}:>
db_version 2.0
db_get <:=${PACKAGE}:>/default || true; _db_default=${RET}

#---B-E-G-I-N---O-L-D---S-T-U-F-F---keep-it,-it-doesn't-hurt-------------------
for i in /usr/lib/emacs/common/auctex/auto/ /var/lib/emacs/auctex/; do
    if test -d ${i}
	then rm -rf ${i}
    fi
done
for i in /usr/lib/emacs/common/auctex /usr/lib/emacs/common; do
    if test -d ${i}
	then find ${i%/*} -name ${i##*/} -type d -empty \
	    | xargs --no-run-if-empty rmdir
    fi
done
#---E-N-D---O-L-D---S-T-U-F-F--------------------------------------------------

conf_autoload () {
    unset -v AUTOLOAD || true
    if [ ${_db_default} = "true" ]
	then AUTOLOAD="(require 'tex-site)"
    fi
    if [ ! -z "${AUTOLOAD}" ]; then umask 022;
	cat <<-EOF ><:="${sstartd}/${EPRIORITY}${PACKAGE}.el":>
		$(echo ${AUTOLOAD} | tr -s " ")
	EOF
	chmod 644 <:="${sstartd}/${EPRIORITY}${PACKAGE}.el":>
    else
	rm -f <:="${sstartd}/${EPRIORITY}${PACKAGE}.el":>
    fi
    return 0
}

do_link () {
    test -d /usr/doc -a ! -e /usr/doc/<:=${PACKAGE}:> \
	 -a -d /usr/share/doc/<:=${PACKAGE}:> \
	 && ln -sf ../share/doc/<:=${PACKAGE}:> /usr/doc/<:=${PACKAGE}:>
    return 0
}

case "${1}" in
    (abort-remove|abort-upgrade|configure)
    <:# abort-remove in-favour ${3:newpkg} ${4:newver}
      # (undo prerm remove in-favour ${3} ${4}):>//
    <:# abort-upgrade ${2:newver}
      # (undo prerm upgrade ${2}):>//
    <:# configure ${2:lastconfver}
      # (or, if there wasn't an old version at all)
      # configure ${2=""|"<unknow>"}
      # (or, if dpkg version is very old)
      # configure
      # (dregistered files and conffiles have been installed):>//
    <:# install byte compiled lisp and do auto:>//
    <:=${EINSTALL}:> <:=${PACKAGE}:>
    <:# install compatibility link:>//
    do_link
    <:# install info menu into info dir:>//
    <:=${DINSTALL}:> <:="${docbase}/${PACKAGE}":>
    <:# install info menu into info dir:>//
    <:=${IINSTALL}:> <:="${info}/${PACKAGE}.info.gz":>
    <:# put or remove emacs startup file:>//
    conf_autoload ;;
    (abort-deconfigure)
    <:# abort-deconfigure in-favour ${3:newpkg} ${4:newver} removing ${6:oldpkg} ${7:oldver}
      # (undo prerm deconfigure in-favour ${3} ${4} removing ${6} ${7}):>//
    <:# put or remove emacs startup file:>//
    conf_autoload ;;
    (*) echo >&2 "${0##*/}: Called with unknown argument \`${1}'." ;;
esac

exit 0
<:
# Local Variables:
# mode: shell-script
# End:
:>//
