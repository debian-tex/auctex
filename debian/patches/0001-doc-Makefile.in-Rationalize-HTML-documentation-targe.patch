From: "Davide G. M. Salvetti" <salve@debian.org>
Date: Wed, 28 Dec 2011 23:21:16 +0100
Subject: doc/Makefile.in: Rationalize HTML documentation targets

- Use auctex.htmls instead of html as the name of the directory where
  AUCTeX HTMLs go.
- Use auctex.html instead of auctex_toc.html as the AUCTeX HTML
  documentation entry point; add index.html as a symlink to it.
- Let the auctex.htmls/auctex.html target (ex html/auctex_toc.html) depend
  on all $(AUCTEXTEXIFILES) instead of just auctex.texi.
- Refactor AUCTeX HTML documentation build command.

- Use preview-latex.htmls instead of preview-latex as the name of the
  directory where preview-latex HTMLs go.
- Use preview-latex.html instead of index.html as the preview-latex HTML
  documentation entry point; add index.html as a symlink to it.
- Refactor preview-latex HTML documentation build command.

- Update references in extradist, html-docs, and clean targets.
---
 doc/Makefile.in | 23 +++++++++++------------
 1 file changed, 11 insertions(+), 12 deletions(-)

diff --git a/doc/Makefile.in b/doc/Makefile.in
index d2be29e..227e347 100644
--- a/doc/Makefile.in
+++ b/doc/Makefile.in
@@ -35,7 +35,7 @@ INSTALL_INFO=@INSTALL_INFO@
 INSTALL=@INSTALL@
 INSTALL_DATA=@INSTALL_DATA@
 DESTDIR=
-TEXI2HTML=@TEXI2HTML@
+TEXI2HTML=@MAKEINFO@ --html
 TEXI2DVI=@TEXI2DVI@
 TEXI2PDF=@TEXI2PDF@
 MKINSTALLDIRS = ../mkinstalldirs
@@ -72,18 +72,16 @@ install-man:
 
 dist: $(DISTTEXTS) preview-latex.info auctex.info tex-ref.pdf
 
-extradist: html/auctex_toc.html auctex.ps auctex.pdf tex-ref.ps tex-ref.pdf
+extradist: auctex.htmls/index.html auctex.ps auctex.pdf tex-ref.ps tex-ref.pdf
 
 .PHONY: all info dvi dist install-auctex disttexts clean distclean \
 	maintainer-clean install-preview install-man html-docs extradist
 
 # AUCTeX
 
-html/auctex_toc.html: auctex.texi
-	rm -rf html
-	mkdir html
-	cd html && $(TEXI2HTML) -split_node -I .. ../auctex.texi && \
-	test ! -d auctex || { mv auctex/* . && rm -rf auctex ; }
+auctex.htmls/index.html: $(AUCTEXTEXIFILES)
+	rm -rf auctex.htmls/
+	$(TEXI2HTML) --output=auctex.htmls --split=chapter auctex.texi
 
 tex-ref.dvi: tex-ref.tex
 	$(TEX) tex-ref
@@ -128,11 +126,12 @@ install-auctex: auctex.info tex-ref.pdf
 
 # preview
 
-preview-latex/index.html: $(PREVIEWTEXIFILES)
-	rm -f preview-latex/*
-	$(TEXI2HTML) preview-latex.texi
+preview-latex.htmls/index.html: $(PREVIEWTEXIFILES)
+	rm -rf preview-latex.htmls/
+	$(TEXI2HTML) --output=preview-latex.htmls \
+		--split=chapter preview-latex.texi
 
-html-docs: preview-latex/index.html
+html-docs: preview-latex.htmls/index.html
 
 preview-dtxdoc.texi: ../preview/latex/preview.dtx preview-dtxdoc.pl
 	-$(PERL) preview-dtxdoc.pl ../preview/latex/preview.dtx \
@@ -189,7 +188,7 @@ clean:
 	rm -f *.dvi *.ps *.pdf *.aux *.cp *.fn *.ky *.log *~ \#*\# \
 		*.tp *.vr *.pg *.toc *.tp *.bak *.cps *.kys *.tps \
 		*.fns *.vrs *.pgs *.tmp *.html
-	rm -rf html preview-latex
+	rm -rf auctex.htmls/ preview-latex.htmls/
 
 distclean: clean
 	rm -f Makefile
