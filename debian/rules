#! /usr/bin/make -f
#
# rules file for Debian auctex package.
# 	$Id: rules,v 1.3 1998/01/12 19:01:45 salve Exp $	
#
# Written by Helmut Geyer <Helmut.Geyer@iwr.uni-heidelberg.de>.
# Rewritten by Davide G. M. Salvetti <salve@debian.org> on Tue, 30 Dec 1997 11:07:00 CET.

package	= auctex
DOCS	= CHANGES README PROBLEMS

tmp	:= $(shell pwd)/debian/tmp/
usr	= $(tmp)/usr/
info	= $(usr)/info/
lisp	= $(usr)/lib/emacs/common/
DEBIAN 	= $(tmp)/DEBIAN/
doc	= $(usr)/doc/$(package)/
cron	= $(tmp)/etc/cron.weekly/
elisp	= $(tmp)/etc/elisp/
sbin	= $(tmp)/usr/sbin/

SHELL		= /bin/bash
INSTDIR		= install -m 755 -d
INSTPROG	= install -m 755 -s
INSTDATA	= install -m 644
INSTSCRIPT	= install -m 755

build:
	$(checkdir)
	$(MAKE) all contrib # EMACS=xemacs
	touch build

clean:
	$(checkdir)
	-rm -rf build core $(tmp) debian/files* debian/substvars
	-rm -f $$(find . -name \*.elc)
	-$(MAKE) clean

binary-arch: checkroot build
	$(checkdir)

binary-indep: checkroot build
	$(checkdir)
	-rm -rf $(tmp)

# install package
	$(INSTDIR) $(info) $(lisp)
	$(MAKE) prefix=$(usr) infodir=$(info) lispdir=$(lisp) install install-contrib install-info
#       remove uncompiled version AND usr/lib/emacs/common/tex-site.el
	rm $$(find $(lisp) -name \*.el)
	gzip -9v $(info)/*

# install Debian system files
	$(INSTDIR) $(cron) $(elisp) $(sbin)
	$(INSTDATA) debian/tex-site.el $(elisp)
	$(INSTSCRIPT) debian/auctex.cron $(cron)/auctex
	$(INSTSCRIPT) debian/auctex-auto-load $(sbin)

# install Debian doc
	$(INSTDIR) $(doc)
	$(INSTDATA) $(DOCS) $(doc)
	$(INSTDATA) ChangeLog $(doc)/changelog
	$(INSTDATA) debian/changelog $(doc)/changelog.Debian
	gzip -9v $(doc)/*
	$(INSTDATA) debian/copyright $(doc)

# install Debian control files
	$(INSTDIR) $(DEBIAN)
	$(INSTDATA) debian/conffiles $(DEBIAN)
	$(INSTSCRIPT) debian/{preinst,postinst,prerm,postrm} $(DEBIAN)

# standard stuff
	cd $(tmp) && md5sum $$(find ./ -path './DEBIAN' -prune -o -type f -printf "%P\n") | sort -k 2 -o DEBIAN/md5sums
	dpkg-gencontrol
	chown -R root.root $(tmp)
	chmod -R go=rX $(tmp)
	dpkg --build $(tmp) ..

binary: binary-indep binary-arch

checkdir = test -f debian/rules

checkroot:
	$(checkdir)
	test root = "$$(whoami)"

source diff:
	@echo >&2 'source and diff are obsolete - use dpkg-source -b'; false

.PHONY: binary binary-arch binary-indep clean checkroot

### Local Variables:
### mode: makefile
### fill-column: 132
### End:
