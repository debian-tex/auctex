#include "variables"
#! /bin/bash -e
#
# <% postinst %> script for <:=${PACKAGE}:>
#
<:=@COPYRIGHT:>//

set -o posix

<:
# parse <% debconf %> database: do not remove,
# even if no further use of it was made here
:>//
source <:=${CONFMODULE}:>
db_version 2.0
db_get <:=${PACKAGE}:>/doauto || true; _db_doauto=${RET}
db_get <:=${PACKAGE}:>/doautofg || true; _db_doautofg=${RET}

#---B-E-G-I-N---O-L-D---S-T-U-F-F---keep-it,-it-doesn't-hurt-------------------
for i in /usr/lib/emacs/common/auctex/auto/ /var/lib/emacs/auctex/; do
    if test -d ${i}
	then rm -rf ${i}
    fi
done
for i in /usr/lib/emacs/common/auctex /usr/lib/emacs/common; do
    if test -d ${i}
	then find ${i%/*} -name ${i##*/} -type d -empty \
	    | xargs --no-run-if-empty rmdir
    fi
done
#---E-N-D---O-L-D---S-T-U-F-F--------------------------------------------------

case "${1}" in
    (abort-deconfigure|abort-remove|abort-upgrade|configure|reconfigure|triggered)
	:;;
    (*) echo >&2 "${0##*/}/<:=${PACKAGE}:>:" \
	"Unknown argument: \"${1}\"."
	exit 1
esac

<:# obsolete conffiles to be removed :>//
for f in 21 22 -snapshot; do
    dpkg-maintscript-helper rm_conffile \
	/etc/emacs${f}/site-start.d/50auctex.el \
	11.86-5 auctex -- "${@}"
done

<:# Emacs install :>//
case "${1}" in
    (abort-deconfigure|abort-remove|abort-upgrade|configure|reconfigure)
	<:=${EINSTALL}:> <:=${PACKAGE}:>;;
esac

<:# New (La)TeX macros have been installed :>//
case "${1}" in
    (triggered)
	LOGFILE=<:=${LOGFILE}:>
	case "${_db_doauto}" in
	    (Foreground)
		case "${_db_doautofg}" in
		    (Console)
			<:="${sbin}/${UPDATE_ELISP}":>;;
		    (File)
			echo >&2 -n "<:=${UPDATE_ELISP}:>: "
			echo >&2 "Further output will appear in: ${LOGFILE}."
			echo >&2 -n "<:=${PACKAGE}:>: "
			echo >&2 -n "Waiting for <:=${UPDATE_ELISP}:> to terminate... "
			<:="${sbin}/${UPDATE_ELISP}":> >> ${LOGFILE} 2>&1
			echo >&2 "done.";;
		    (*) echo >&2 \
			"${0##*/}: Unknown Debconf value doautofg = \"${_db_doautofg}\".";;
		esac;;
	    (Background)
		<:# Closing fd 3 is debconf important. :>//
		<:# debconf\'s frontend wait for its standard input to be closed :>//
		<:# before dying, and that means fd 3 :>//
		<:# better don\'t close fd 0: Emacs does not take it very well :>//
		<:# WARNING: DON\'T CLOSE FD\'S TO BE WRITTEN TO! :>//
		<:# WARNING: DON\'T CLOSE FD\'S TO BE READ TO! :>//
		<:="${sbin}/${UPDATE_ELISP}":> >> ${LOGFILE} 2>&1 3>&- &
		echo >&2 -n "<:=${UPDATE_ELISP}:>[${!}]: "
		echo >&2 "Further output will appear in: ${LOGFILE}.";;
	    (None) :;;
	    (*) echo >&2 \
		"${0##*/}: Unknown Debconf value doauto = \"${_db_doauto}\".";;
	esac;;
esac

exit 0
<:
# local variables:
# mode: shell-script
# ispell-local-dictionary: "american"
# ispell-check-comments: exclusive
# end:
#
# LocalWords:  emacs
:>//
